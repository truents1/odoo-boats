<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Boat Tree View -->
    <record id="view_boat_boat_tree" model="ir.ui.view">
        <field name="name">boat.boat.tree</field>
        <field name="model">boat.boat</field>
        <field name="arch" type="xml">
            <tree>
                <field name="image_128" widget="image" optional="show"/>
                <field name="name"/>
                <field name="category_id"/>
                <field name="location_id"/>
                <field name="owner_id"/>
                <field name="guest_capacity"/>
                <field name="base_price_per_day"/>
                <field name="state" 
                       decoration-info="state == 'submitted'" 
                       decoration-warning="state == 'under_review'"
                       decoration-success="state == 'approved' or state == 'published'"
                       decoration-danger="state == 'rejected'"
                       widget="badge"/>
                <field name="image_count" optional="hide"/>
            </tree>
        </field>
    </record>

    <!-- Boat Form View with Image Gallery -->
    <record id="view_boat_boat_form" model="ir.ui.view">
        <field name="name">boat.boat.form</field>
        <field name="model">boat.boat</field>
        <field name="arch" type="xml">
            <form string="Boat">
                <header>
                    <button name="action_submit" 
                            string="Submit for Review" 
                            type="object" 
                            class="btn-primary"
                            invisible="state != 'draft'"/>
                    <button name="action_approve" 
                            string="Approve" 
                            type="object" 
                            class="btn-success"
                            invisible="state != 'submitted' and state != 'under_review'"
                            groups="boat_base.group_boat_manager"/>
                    <button name="action_reject" 
                            string="Reject" 
                            type="object" 
                            class="btn-danger"
                            invisible="state != 'submitted' and state != 'under_review'"
                            groups="boat_base.group_boat_manager"/>
                    <button name="action_publish" 
                            string="Publish" 
                            type="object" 
                            class="btn-primary"
                            invisible="state != 'approved'"
                            groups="boat_base.group_boat_manager"/>
                    <button name="action_set_unavailable" 
                            string="Set Unavailable" 
                            type="object"
                            invisible="state != 'published'"
                            groups="boat_base.group_boat_manager"/>
                    <field name="state" widget="statusbar" 
                           statusbar_visible="draft,submitted,approved,published"/>
                </header>
                <sheet>
                    <!-- Remove the default image field from top-right corner -->
                    <!-- Image Gallery Section -->
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Boat Name"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group>
                            <field name="category_id"/>
                            <field name="location_id"/>
                            <field name="owner_id" options="{'no_create': True}"/>
                        </group>
                        <group>
                            <field name="guest_capacity"/>
                            <field name="cabins"/>
                            <field name="is_available" widget="boolean_toggle"/>
                        </group>
                    </group>

                    <!-- Images Section with Gallery -->
                    <notebook>
                        <page string="Images" name="images">
                            <group>
                                <group>
                                    <field name="image_count" readonly="1"/>
                                    <field name="featured_image_id" readonly="1"/>
                                </group>
                            </group>
                            
                            <div class="alert alert-info" role="alert">
                                <strong>Image Gallery:</strong> Upload multiple images below. 
                                Use the "Set Featured" button on an image to make it the main display image for this boat.
                                The first image uploaded will automatically be set as featured.
                            </div>

                            <field name="image_ids" 
                                   widget="one2many" 
                                   mode="kanban"
                                   context="{'default_boat_id': active_id}">
                                <kanban class="o_boat_image_kanban">
                                    <field name="id"/>
                                    <field name="name"/>
                                    <field name="image_256"/>
                                    <field name="is_featured"/>
                                    <field name="sequence"/>
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div class="oe_kanban_global_click o_kanban_image_card">
                                                <div class="o_kanban_image">
                                                    <img t-att-src="kanban_image('boat.image', 'image_256', record.id.raw_value)" 
                                                         alt="Boat Image" 
                                                         class="o_image_64_max"/>
                                                    
                                                    <!-- Featured Badge -->
                                                    <div class="ribbon ribbon-top-right" t-if="record.is_featured.raw_value">
                                                        <span class="bg-warning text-white">
                                                            <i class="fa fa-star"/> Featured
                                                        </span>
                                                    </div>
                                                    
                                                    <!-- Action Buttons -->
                                                    <div class="o_kanban_image_actions">
                                                        <button type="object" 
                                                                name="action_set_featured" 
                                                                class="btn btn-sm btn-primary"
                                                                t-if="!record.is_featured.raw_value"
                                                                title="Set as Featured">
                                                            <i class="fa fa-star-o"/>
                                                        </button>
                                                        
                                                        <button type="object" 
                                                                name="action_remove_featured" 
                                                                class="btn btn-sm btn-warning"
                                                                t-if="record.is_featured.raw_value"
                                                                title="Remove Featured">
                                                            <i class="fa fa-star"/>
                                                        </button>
                                                        
                                                        <button type="delete" 
                                                                class="btn btn-sm btn-danger"
                                                                title="Delete">
                                                            <i class="fa fa-trash-o"/>
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <div class="o_kanban_details">
                                                    <field name="sequence" widget="handle"/>
                                                    <span t-if="record.is_featured.raw_value" class="badge badge-warning">
                                                        <i class="fa fa-star"/> Main Image
                                                    </span>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                                
                                <!-- Tree view fallback -->
                                <tree editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="image_128" widget="image"/>
                                    <field name="name"/>
                                    <field name="is_featured" widget="boolean_toggle"/>
                                </tree>
                                
                                <!-- Form view for creating/editing images -->
                                <form>
                                    <group>
                                        <field name="image_1920" widget="image" class="oe_avatar"/>
                                        <field name="sequence"/>
                                        <field name="is_featured"/>
                                    </group>
                                </form>
                            </field>
                        </page>

                        <page string="Details" name="details">
                            <group>
                                <group string="Boat Information">
                                    <field name="length"/>
                                    <field name="year_built"/>
                                </group>
                                <group string="Pricing">
                                    <field name="base_price_per_day"/>
                                    <field name="weekend_price_per_day"/>
                                    <field name="peak_season_price_per_day"/>
                                </group>
                            </group>
                            
                            <group string="Features">
                                <group>
                                    <field name="has_wifi"/>
                                    <field name="has_kitchen"/>
                                </group>
                                <group>
                                    <field name="has_air_conditioning"/>
                                </group>
                            </group>
                            
                            <group string="Description">
                                <field name="description" nolabel="1"/>
                            </group>
                        </page>

                        <page string="Availability" name="availability">
                            <group>
                                <group>
                                    <field name="available_from"/>
                                    <field name="available_to"/>
                                </group>
                                <group>
                                    <field name="is_available"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Boat Kanban View -->
    <record id="view_boat_boat_kanban" model="ir.ui.view">
        <field name="name">boat.boat.kanban</field>
        <field name="model">boat.boat</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="id"/>
                <field name="name"/>
                <field name="image_256"/>
                <field name="category_id"/>
                <field name="location_id"/>
                <field name="base_price_per_day"/>
                <field name="state"/>
                <field name="image_count"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_image">
                                <img t-att-src="kanban_image('boat.boat', 'image_256', record.id.raw_value)" 
                                     alt="Boat" 
                                     class="o_image_64_max"/>
                                <div class="ribbon ribbon-top-right" t-if="record.image_count.raw_value gt 1">
                                    <span class="bg-info">
                                        <i class="fa fa-images"/> <t t-esc="record.image_count.value"/>
                                    </span>
                                </div>
                            </div>
                            <div class="oe_kanban_details">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                    </div>
                                    <field name="state" widget="label_selection" 
                                           options="{'classes': {'draft': 'secondary', 'submitted': 'info', 
                                                    'approved': 'success', 'published': 'success', 
                                                    'rejected': 'danger'}}"/>
                                </div>
                                <div class="o_kanban_record_body">
                                    <field name="category_id"/>
                                    <field name="location_id"/>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <span class="badge badge-pill badge-primary">
                                            $<field name="base_price_per_day"/>/day
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Boat Search View -->
    <record id="view_boat_boat_search" model="ir.ui.view">
        <field name="name">boat.boat.search</field>
        <field name="model">boat.boat</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="category_id"/>
                <field name="location_id"/>
                <field name="owner_id"/>
                <filter string="Available" name="available" domain="[('is_available', '=', True)]"/>
                <filter string="Published" name="published" domain="[('state', '=', 'published')]"/>
                <group expand="0" string="Group By">
                    <filter string="Category" name="category" context="{'group_by': 'category_id'}"/>
                    <filter string="Location" name="location" context="{'group_by': 'location_id'}"/>
                    <filter string="Owner" name="owner" context="{'group_by': 'owner_id'}"/>
                    <filter string="Status" name="state" context="{'group_by': 'state'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Boat Action -->
    <record id="action_boat_boat" model="ir.actions.act_window">
        <field name="name">Boats</field>
        <field name="res_model">boat.boat</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'search_default_available': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first boat listing
            </p>
            <p>
                Add boats to your platform with detailed information and multiple images.
            </p>
        </field>
    </record>

    <!-- Menu Items -->
    <menuitem id="menu_boat_root" name="Boats" sequence="10"/>
    
    <menuitem id="menu_boat_boats" 
              name="Boats" 
              parent="menu_boat_root" 
              action="action_boat_boat" 
              sequence="10"/>
              
    <menuitem id="menu_boat_images" 
              name="Images" 
              parent="menu_boat_root" 
              action="action_boat_image" 
              sequence="20"/>
</odoo>